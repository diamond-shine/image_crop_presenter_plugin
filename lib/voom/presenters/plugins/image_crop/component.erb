<script src="https://cdn.jsdelivr.net/npm/croppr@2.3.1/dist/croppr.min.js"></script>
<script type="text/javascript">
  const load = function() {
    const ic = new ImageCrop();
    ic.run();
  }
  window.onload = load;

  class ImageCrop {
    constructor() {
      this.element = document.querySelector('.v-image-crop');
      this.image = this.element.querySelector('img');
      this.handleCropEnd = this.handleCropEnd.bind(this);
    }

    run() {
      this.setupCroppr();
    }

    setupCroppr() {
      if(typeof Croppr !== "function") {
        return;
      }

      this.croppr = new Croppr(this.image, {
        onCropEnd: this.handleCropEnd
      });
    }

    handleCropEnd(data) {
      const keys = Object.keys(data);
      const currentElem = this.element;
      keys.forEach(function(k) {
        const attrElem = currentElem.querySelector(`input[name=crop_${k}]`);
        if(attrElem) {
          attrElem.value = data[k];
        }
      });
    }
  }
</script>

<div class="v-image-crop">
  <% comp.crop_attrs.each do |attr| %>
    <input type="hidden" name="<%= attr %>" />
  <% end %>
  <img id="<%= comp.id %>" src="<%= comp.url %>" height="<%= comp.height %>" width="<%= comp.width %>" border="0" alt="" />
</div>